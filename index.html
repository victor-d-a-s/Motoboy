<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sou Flash - √Årea do Parceiro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.16/jquery.mask.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    
    <style>
        /* TEMA ESCURO */
        body { font-family: 'Segoe UI', sans-serif; background-color: #111827; color: #e5e7eb; }
        .dark-card { background-color: #1f2937; border: 1px solid #374151; }
        .dark-input { background-color: #111827; border: 1px solid #4b5563; color: white; transition: border-color 0.3s; }
        .dark-input:focus { border-color: #FBBF24; outline: none; }
        .dark-input:disabled { background-color: #1f2937; color: #6b7280; cursor: not-allowed; }
        .dark-input:read-only { background-color: #374151; color: #9CA3AF; cursor: not-allowed; }
        
        /* Valida√ß√£o Visual */
        .input-error { border-color: #EF4444 !important; background-color: rgba(239, 68, 68, 0.1); }
        .input-success { border-color: #10B981 !important; }

        /* Checkboxes */
        .checkbox-label { display: flex; align-items: center; gap: 8px; background-color: #111827; padding: 10px; border-radius: 8px; border: 1px solid #4b5563; cursor: pointer; transition: all 0.2s; }
        .checkbox-label:hover { border-color: #FBBF24; }
        .custom-checkbox { accent-color: #FBBF24; width: 18px; height: 18px; }
        
        /* Destaque do Protocolo */
        .msg-zap { background-color: #075E54; color: white; border-radius: 0 10px 10px 10px; padding: 10px; font-size: 13px; border-left: 4px solid #25D366; }
        .codigo-destaque { background-color: rgba(0,0,0,0.3); padding: 2px 6px; border-radius: 4px; font-family: monospace; color: #FBBF24; font-weight: bold; }
        .fade-in { animation: fadeIn 0.4s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center p-4 pb-20">

    <div class="w-full max-w-md text-center mb-6 mt-4">
        <div class="inline-block p-3 rounded-full bg-yellow-400 text-black mb-2 shadow-lg shadow-yellow-500/20">
            <i class="fas fa-motorcycle text-3xl"></i>
        </div>
        <h1 class="text-2xl font-bold text-white">Parceiro <span class="text-yellow-400">Flash</span></h1>
        <p class="text-xs text-gray-400">Ferramenta Oficial do Entregador</p>
    </div>

    <div class="w-full max-w-md flex mb-6 bg-gray-800 rounded-xl p-1 shadow-lg border border-gray-700">
        <button onclick="mudarAba('cadastro')" id="btn-cadastro" class="flex-1 py-2 text-sm font-bold rounded-lg bg-gray-700 text-white transition">Cadastro</button>
        <button onclick="mudarAba('tutorial')" id="btn-tutorial" class="flex-1 py-2 text-sm font-bold rounded-lg text-gray-400 hover:text-white transition">Como Usar</button>
        <button onclick="mudarAba('calc')" id="btn-calc" class="flex-1 py-2 text-sm font-bold rounded-lg text-gray-400 hover:text-white transition">Ganhos</button>
    </div>

    <div id="aba-cadastro" class="w-full max-w-md dark-card rounded-2xl p-5 shadow-2xl fade-in">
        <h2 class="text-lg font-bold text-white mb-1">Novo por aqui?</h2>
        <p class="text-xs text-gray-400 mb-4">Preencha sua ficha completa.</p>
        
        <div class="space-y-4">
            <div><label class="text-[10px] uppercase font-bold text-gray-500">Seu CPF</label><input type="text" id="cad-cpf" class="w-full dark-input rounded-lg p-3" placeholder="000.000.000-00"></div>
            
            <div><label class="text-[10px] uppercase font-bold text-gray-500">Nome Completo</label><input type="text" id="cad-nome" class="w-full dark-input rounded-lg p-3" placeholder="Ex: Jo√£o da Silva"></div>
            
            <div class="grid grid-cols-3 gap-3">
                <div>
                    <label class="text-[10px] uppercase font-bold text-gray-500">Sexo</label>
                    <select id="cad-sexo" class="w-full dark-input rounded-lg p-3 text-white text-sm">
                        <option value="" disabled selected>---</option>
                        <option value="Masculino">Masc</option>
                        <option value="Feminino">Fem</option>
                    </select>
                </div>
                <div>
                    <label class="text-[10px] uppercase font-bold text-gray-500">Nascimento</label>
                    <input type="text" id="cad-nasc" onblur="calcularIdade()" class="w-full dark-input rounded-lg p-3 text-center" placeholder="Dia/M√™s/Ano">
                </div>
                <div>
                    <label class="text-[10px] uppercase font-bold text-gray-500">Idade</label>
                    <input type="text" id="cad-idade" class="w-full dark-input rounded-lg p-3 text-center font-bold" readonly>
                </div>
            </div>

            <div><label class="text-[10px] uppercase font-bold text-gray-500">WhatsApp</label><input type="text" id="cad-zap" class="w-full dark-input rounded-lg p-3" placeholder="(00) 00000-0000"></div>

            <div class="bg-gray-800 p-3 rounded-lg border border-gray-700">
                <p class="text-[10px] uppercase font-bold text-blue-400 mb-2">Endere√ßo Residencial</p>
                <div class="mb-3 relative">
                    <label class="text-[10px] text-gray-500">CEP</label>
                    <input type="text" id="cad-cep" onblur="buscarCep()" class="w-full dark-input rounded-lg p-2" placeholder="00000-000">
                    <div id="loading-cep" class="absolute right-3 top-8 hidden"><i class="fas fa-spinner fa-spin text-blue-500"></i></div>
                    <p id="erro-cep" class="text-[10px] text-red-500 mt-1 hidden">CEP inv√°lido!</p>
                </div>
                <div class="mb-3"><label class="text-[10px] text-gray-500">Rua</label><input type="text" id="cad-rua" class="w-full dark-input rounded-lg p-2 bg-gray-900" readonly></div>
                <div class="grid grid-cols-3 gap-3 mb-3">
                    <div class="col-span-1"><label class="text-[10px] text-gray-500">N√∫mero</label><input type="text" id="cad-numero" class="w-full dark-input rounded-lg p-2"></div>
                    <div class="col-span-2"><label class="text-[10px] text-gray-500">Bairro</label><input type="text" id="cad-bairro" class="w-full dark-input rounded-lg p-2 bg-gray-900" readonly></div>
                </div>
                <div><label class="text-[10px] text-gray-500">Cidade/UF</label><input type="text" id="cad-cidade" class="w-full dark-input rounded-lg p-2 bg-gray-900" readonly></div>
            </div>
            
            <div class="bg-red-900/10 p-3 rounded-lg border border-red-900/30">
                <p class="text-[10px] uppercase font-bold text-red-400 mb-2"><i class="fas fa-ambulance mr-1"></i> Contato de Emerg√™ncia</p>
                <div class="mb-3">
                    <label class="text-[10px] text-gray-500">Nome do Parente/Amigo</label>
                    <input type="text" id="cad-emergencia-nome" class="w-full dark-input rounded-lg p-2" placeholder="Ex: Maria">
                </div>
                <div class="grid grid-cols-2 gap-3">
                    <div>
                        <label class="text-[10px] text-gray-500">Parentesco</label>
                        <input type="text" id="cad-emergencia-grau" class="w-full dark-input rounded-lg p-2" placeholder="Ex: M√£e, Esposa">
                    </div>
                    <div>
                        <label class="text-[10px] text-gray-500">Telefone (C/ DDD)</label>
                        <input type="text" id="cad-emergencia-tel" class="w-full dark-input rounded-lg p-2" placeholder="(00) 00000-0000">
                    </div>
                </div>
            </div>

            <div class="bg-gray-800 p-3 rounded-lg border border-gray-700">
                <p class="text-[10px] uppercase font-bold text-yellow-500 mb-2">Dados da Moto</p>
                <div class="grid grid-cols-2 gap-3 mb-3">
                    <div>
                        <label class="text-[10px] text-gray-500">Placa</label>
                        <input type="text" id="cad-placa" class="w-full dark-input rounded-lg p-2 uppercase font-bold" placeholder="ABC-1234">
                    </div>
                    <div><label class="text-[10px] text-gray-500">Modelo</label><input type="text" id="cad-modelo" class="w-full dark-input rounded-lg p-2" placeholder="Ex: Fan 160"></div>
                </div>
                <div><label class="text-[10px] text-gray-500">Cor</label><input type="text" id="cad-cor" class="w-full dark-input rounded-lg p-2" placeholder="Ex: Vermelha"></div>
            </div>

            <div><label class="text-[10px] uppercase font-bold text-gray-500 mb-1 block">Foto do CRLV</label><input type="file" id="cad-crlv-foto" accept="image/*" class="w-full text-sm text-gray-400 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-xs file:font-bold file:bg-gray-700 file:text-white hover:file:bg-gray-600 cursor-pointer"/></div>
            
            <div class="grid grid-cols-3 gap-3">
                <div class="col-span-1">
                    <label class="text-[10px] uppercase font-bold text-gray-500">Tipo Doc</label>
                    <select id="cad-tipo-doc" class="w-full dark-input rounded-lg p-3 text-white text-sm">
                        <option value="CNH">CNH</option>
                        <option value="RG">RG</option>
                    </select>
                </div>
                <div class="col-span-2">
                    <label class="text-[10px] uppercase font-bold text-gray-500">N√∫mero do Documento</label>
                    <input type="text" id="cad-doc" class="w-full dark-input rounded-lg p-3" placeholder="Digite o n√∫mero">
                </div>
            </div>
            
            <div><label class="text-[10px] uppercase font-bold text-gray-500 mb-1 block">Foto do Documento (Frente/Verso)</label><input type="file" id="cad-doc-foto" accept="image/*" multiple class="w-full text-sm text-gray-400 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-xs file:font-bold file:bg-gray-700 file:text-white hover:file:bg-gray-600 cursor-pointer"/></div>

            <div class="grid grid-cols-3 gap-3">
                <div class="col-span-1">
                    <label class="text-[10px] uppercase font-bold text-gray-500">Tipo Pix</label>
                    <select id="cad-tipo-pix" class="w-full dark-input rounded-lg p-3 text-white text-sm">
                        <option value="CPF/CNPJ">CPF</option>
                        <option value="Celular">Celular</option>
                        <option value="Email">Email</option>
                        <option value="Aleat√≥ria">Aleat√≥ria</option>
                    </select>
                </div>
                <div class="col-span-2">
                    <label class="text-[10px] uppercase font-bold text-gray-500">Chave PIX</label>
                    <input type="text" id="cad-pix" class="w-full dark-input rounded-lg p-3" placeholder="Digite a chave">
                </div>
            </div>

            <div>
                <label class="text-[10px] uppercase font-bold text-gray-500 mb-2 block">Disponibilidade</label>
                <div class="grid grid-cols-2 gap-2 text-sm text-gray-300">
                    <label class="checkbox-label"><input type="checkbox" name="disp" value="Manh√£" class="custom-checkbox"> Manh√£</label>
                    <label class="checkbox-label"><input type="checkbox" name="disp" value="Tarde" class="custom-checkbox"> Tarde</label>
                    <label class="checkbox-label"><input type="checkbox" name="disp" value="Noite" class="custom-checkbox"> Noite</label>
                    <label class="checkbox-label"><input type="checkbox" name="disp" value="Integral" class="custom-checkbox"> Integral</label>
                    <label class="checkbox-label col-span-2"><input type="checkbox" name="disp" value="Renda Extra" class="custom-checkbox"> Renda Extra</label>
                </div>
            </div>

            <button onclick="enviarCadastro()" id="btn-enviar-cad" class="w-full bg-yellow-400 text-black font-bold py-3 rounded-xl shadow-lg hover:bg-yellow-300 transform active:scale-95 transition flex justify-center items-center gap-2 mt-4">
                <i class="fab fa-whatsapp text-xl"></i> Enviar Ficha Completa
            </button>
        </div>
    </div>

    <div id="aba-tutorial" class="w-full max-w-md dark-card rounded-2xl p-5 shadow-2xl fade-in hidden">
        <h2 class="text-lg font-bold text-white mb-4 flex items-center gap-2"><i class="fas fa-info-circle text-yellow-400"></i> Entendendo o Valor</h2>
        <div class="space-y-4">
            <p class="text-sm text-gray-300">Seu pagamento est√° no c√≥digo "Prot" da mensagem.</p>
            <div class="msg-zap">
                <p class="font-bold text-xs text-green-300 mb-1">Pedido:</p>
                <p>üìç Retirada: Shopping...</p>
                <p>üí∞ Pagamento: PIX</p>
                <p class="mt-2">üîë Prot: <span class="codigo-destaque">#01450</span></p>
            </div>
            <div class="bg-gray-800 p-4 rounded-xl border border-gray-700 text-sm">
                <p class="mb-2"><span class="text-gray-400">#01450</span> ‚ûî <span class="text-green-400 font-bold">R$ 14,50</span></p>
                <p><span class="text-gray-400">#00800</span> ‚ûî <span class="text-green-400 font-bold">R$ 8,00</span></p>
            </div>
        </div>
    </div>

    <div id="aba-calc" class="w-full max-w-md dark-card rounded-2xl p-5 shadow-2xl fade-in hidden">
        <h2 class="text-lg font-bold text-white mb-1">Extrato Oficial</h2>
        <p class="text-xs text-gray-400 mb-4">Consulte o saldo liberado pela Central.</p>
        <div class="space-y-4">
            <div>
                <label class="text-[10px] uppercase font-bold text-gray-500">Seu CPF (Cadastrado)</label>
                <div class="flex gap-2">
                    <input type="text" id="login-cpf" class="flex-1 dark-input rounded-lg p-3 text-center tracking-widest font-bold" placeholder="000.000.000-00">
                    <button onclick="buscarSaldo()" class="bg-blue-600 text-white px-4 rounded-lg font-bold hover:bg-blue-500"><i class="fas fa-search"></i></button>
                </div>
            </div>
            <div id="painel-saldo" class="hidden">
                <div class="bg-gray-900 p-6 rounded-xl border border-gray-700 mb-4 text-center relative overflow-hidden">
                    <div class="absolute inset-0 opacity-10 bg-green-500 blur-xl"></div>
                    <p class="text-gray-400 text-xs uppercase tracking-widest mb-1 relative z-10">Total Acumulado</p>
                    <p id="total-ganho" class="text-green-400 font-bold text-4xl relative z-10">R$ 0,00</p>
                    <p class="text-gray-500 text-xs mt-2 relative z-10"><span id="qtd-corridas">0</span> lan√ßamentos encontrados</p>
                </div>
            </div>
            <div id="loading-saldo" class="hidden text-center py-4">
                <i class="fas fa-spinner fa-spin text-2xl text-blue-500"></i>
                <p class="text-xs text-gray-400 mt-2">Consultando planilha...</p>
            </div>
        </div>
    </div>

    <script>
        $(document).ready(function(){ 
            $('#cad-zap').mask('(00) 00000-0000'); 
            $('#cad-emergencia-tel').mask('(00) 00000-0000');
            $('#cad-cpf').mask('000.000.000-00'); 
            $('#cad-nasc').mask('00/00/0000');
            $('#cad-cep').mask('00000-000');
            $('#login-cpf').mask('000.000.000-00');
            
            // For√ßa Placa Mai√∫scula (Input Event)
            $('#cad-placa').on('input', function() { 
                $(this).val($(this).val().toUpperCase()); 
            });
        });

        function mudarAba(abaNome) {
            ['cadastro', 'tutorial', 'calc'].forEach(aba => {
                document.getElementById('aba-' + aba).classList.add('hidden');
                document.getElementById('btn-' + aba).classList.remove('bg-gray-700', 'text-white');
                document.getElementById('btn-' + aba).classList.add('text-gray-400');
            });
            document.getElementById('aba-' + abaNome).classList.remove('hidden');
            const btnAtivo = document.getElementById('btn-' + abaNome);
            btnAtivo.classList.remove('text-gray-400');
            btnAtivo.classList.add('bg-gray-700', 'text-white');
        }

        // --- C√ÅLCULO DE IDADE ---
        function calcularIdade() {
            const dataStr = document.getElementById('cad-nasc').value;
            const campoNasc = document.getElementById('cad-nasc');
            const campoIdade = document.getElementById('cad-idade');
            campoIdade.value = "";
            campoNasc.classList.remove('input-error');

            if(dataStr.length !== 10) return;

            const partes = dataStr.split('/');
            const dia = parseInt(partes[0]);
            const mes = parseInt(partes[1]);
            const ano = parseInt(partes[2]);

            // Valida Data
            const dateObj = new Date(ano, mes - 1, dia);
            if (dateObj.getFullYear() !== ano || dateObj.getMonth() + 1 !== mes || dateObj.getDate() !== dia) {
                alert("Data inv√°lida!"); campoNasc.classList.add('input-error'); return;
            }

            const hoje = new Date();
            let idade = hoje.getFullYear() - ano;
            const m = hoje.getMonth() - (mes - 1);
            if (m < 0 || (m === 0 && hoje.getDate() < dia)) idade--;

            if (idade < 18) { alert("Menor de 18 anos n√£o permitido."); campoNasc.value = ""; return; }
            if (idade > 100) { alert("Data inv√°lida."); campoNasc.value = ""; return; }

            campoIdade.value = idade;
        }

        // --- BUSCA CEP ---
        async function buscarCep() {
            let cepField = document.getElementById('cad-cep');
            let cep = cepField.value.replace(/\D/g, '');
            cepField.classList.remove('input-error', 'input-success');
            document.getElementById('erro-cep').classList.add('hidden');

            if(cep.length !== 8) return;
            document.getElementById('loading-cep').classList.remove('hidden');

            try {
                const res = await fetch(`https://viacep.com.br/ws/${cep}/json/`);
                const data = await res.json();
                if(!data.erro) {
                    document.getElementById('cad-rua').value = data.logradouro;
                    document.getElementById('cad-bairro').value = data.bairro;
                    document.getElementById('cad-cidade').value = `${data.localidade}/${data.uf}`;
                    document.getElementById('cad-numero').focus();
                    cepField.classList.add('input-success');
                } else {
                    document.getElementById('cad-rua').value = "";
                    cepField.classList.add('input-error');
                    document.getElementById('erro-cep').classList.remove('hidden');
                }
            } catch(e) { console.error(e); } finally { document.getElementById('loading-cep').classList.add('hidden'); }
        }
        // --- VALIDA√á√ïES ESTRUTURAIS ---
        function validarCPF(cpf) {
            cpf = cpf.replace(/[^\d]+/g, '');
            if (cpf == '' || cpf.length != 11 || /^(\d)\1{10}$/.test(cpf)) return false;
            let add = 0; for (let i=0; i < 9; i ++) add += parseInt(cpf.charAt(i)) * (10 - i);
            let rev = 11 - (add % 11); if (rev == 10 || rev == 11) rev = 0;
            if (rev != parseInt(cpf.charAt(9))) return false;
            add = 0; for (let i = 0; i < 10; i ++) add += parseInt(cpf.charAt(i)) * (11 - i);
            rev = 11 - (add % 11); if (rev == 10 || rev == 11) rev = 0;
            if (rev != parseInt(cpf.charAt(10))) return false;
            return true;
        }
        
        function validarPlaca(placa) {
            // Remove tudo que n√£o √© alfanum√©rico e deixa mai√∫sculo
            const limpa = placa.replace(/[^a-zA-Z0-9]/g, '').toUpperCase();
            
            // Antiga: 3 Letras e 4 N√∫meros (ABC1234)
            const antiga = /^[A-Z]{3}[0-9]{4}$/;
            
            // Mercosul: 3 Letras, 1 N√∫mero, 1 Letra, 2 N√∫meros (ABC1C34)
            const mercosul = /^[A-Z]{3}[0-9][A-Z][0-9]{2}$/;
            
            return antiga.test(limpa) || mercosul.test(limpa);
        }

        function validarTelefone(telefone) {
            const limpo = telefone.replace(/\D/g, '');
            if (limpo.length !== 11) return false;
            if (parseInt(limpo.substring(0, 2)) < 11 || parseInt(limpo.substring(2, 3)) !== 9) return false;
            return true;
        }

        // --- CADASTRO (SHEETMONKEY) ---
        function enviarCadastro() {
            // Coleta
            const nome = document.getElementById('cad-nome').value;
            const sexo = document.getElementById('cad-sexo').value;
            const nasc = document.getElementById('cad-nasc').value;
            const idade = document.getElementById('cad-idade').value;
            const zap = document.getElementById('cad-zap').value;
            const cep = document.getElementById('cad-cep').value;
            const rua = document.getElementById('cad-rua').value;
            const num = document.getElementById('cad-numero').value;
            const bairro = document.getElementById('cad-bairro').value;
            const cidade = document.getElementById('cad-cidade').value;
            
            const emerNome = document.getElementById('cad-emergencia-nome').value;
            const emerGrau = document.getElementById('cad-emergencia-grau').value;
            const emerTel = document.getElementById('cad-emergencia-tel').value;
            
            const placa = document.getElementById('cad-placa').value;
            const modelo = document.getElementById('cad-modelo').value;
            const cor = document.getElementById('cad-cor').value;
            
            const cpf = document.getElementById('cad-cpf').value;
            const tipoDoc = document.getElementById('cad-tipo-doc').value;
            const doc = document.getElementById('cad-doc').value;
            
            const tipoPix = document.getElementById('cad-tipo-pix').value;
            const pix = document.getElementById('cad-pix').value;

            let checkboxes = document.querySelectorAll('input[name="disp"]:checked');
            let dispArray = []; checkboxes.forEach((cb) => { dispArray.push(cb.value); });
            let dispFinal = dispArray.join(", ");

            const temFotoCRLV = document.getElementById('cad-crlv-foto').files.length > 0;
            const temFotoDoc = document.getElementById('cad-doc-foto').files.length > 0;

            // Valida√ß√µes
            if(!nome || !sexo || !zap || !placa || !cpf || !pix || !nasc || !bairro || !emerNome || !num) { alert("Preencha todos os campos!"); return; }
            if(dispFinal === "") { alert("Marque a disponibilidade!"); return; }
            if(!validarCPF(cpf)) { alert("CPF Inv√°lido!"); return; }
            if(!validarPlaca(placa)) { alert("Placa Inv√°lida! Use formato Antigo ou Mercosul."); return; }
            if(!validarTelefone(zap)) { alert("WhatsApp inv√°lido!"); return; }
            if(!validarTelefone(emerTel)) { alert("Telefone de emerg√™ncia inv√°lido!"); return; }
            if(!temFotoCRLV || !temFotoDoc) { alert("Anexe as fotos dos documentos!"); return; }

            const btn = document.getElementById('btn-enviar-cad');
            btn.innerHTML = 'Salvando...'; btn.disabled = true;

            const dados = {
                'x-sheetmonkey-insert-worksheet': 'Motoboys',
                'Data': new Date().toLocaleString(), 'Nome': nome, 'Sexo': sexo, 'Nascimento': nasc, 'Idade': idade,
                'WhatsApp': zap, 'CEP': cep, 'Endere√ßo': `${rua}, ${num}`, 'Bairro': bairro, 'Cidade': cidade, 
                'Emergencia_Nome': emerNome, 'Emergencia_Parentesco': emerGrau, 'Emergencia_Tel': emerTel,
                'Placa': placa, 'Modelo': modelo, 'Cor': cor, 
                'Tipo_Doc': tipoDoc, 'Documento': doc, 'CPF': cpf, 
                'Tipo_Pix': tipoPix, 'Pix': pix, 'Disponibilidade': dispFinal
            };

            const urlSheetMonkey = "https://api.sheetmonkey.io/form/bjbGYT8y9RCwwAk71aqbLr"; 

            fetch(urlSheetMonkey, {
                method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(dados)
            }).then(() => {
                const numAdmin = "5584982005039"; 
                const msg = `üèçÔ∏è *NOVO CADASTRO*%0Aüë§ *Nome:* ${nome} (${idade} anos)%0Aüì± *Zap:* ${zap}%0Aüìç *Local:* ${bairro}%0Aüõµ *Moto:* ${modelo} - ${placa}%0AüÜî *Doc:* ${tipoDoc} - ${doc}%0Aüí† *PIX:* ${tipoPix} - ${pix}%0Aüö® *SOS:* ${emerNome} - ${emerTel}%0Aüì∏ *FOTOS PRONTAS!*`;
                window.open(`https://wa.me/${numAdmin}?text=${msg}`, '_blank');
                btn.innerHTML = 'Enviar Ficha Completa'; btn.disabled = false;
            }).catch(e => { alert("Erro ao salvar."); btn.disabled = false; });
        }
        // --- BUSCA SALDO (ROBUSTA) ---
        async function buscarSaldo() {
            const cpfInput = document.getElementById('login-cpf').value;
            const cpfBusca = cpfInput.trim();

            if(cpfBusca.length < 14) { alert("Digite o CPF completo."); return; }

            document.getElementById('loading-saldo').classList.remove('hidden');
            document.getElementById('painel-saldo').classList.add('hidden');

            const urlSheetDB = "https://sheetdb.io/api/v1/i845olyhjg02x";

            try {
                // Busca na aba 'Pagamentos' com limite de 1000 linhas
                const res = await axios.get(`${urlSheetDB}/search?sheet=Pagamentos&CPF=${cpfBusca}&limit=1000`);
                const dados = res.data;

                if (dados.length === 0) {
                    alert("Nenhum pagamento encontrado. Verifique se o CPF na planilha est√° formatado (com pontos e tra√ßo).");
                    document.getElementById('loading-saldo').classList.add('hidden');
                    return;
                }

                let soma = 0;
                let contagem = 0;

                dados.forEach(item => {
                    let v = item.Valor;
                    if(v) {
                        // Limpa R$, espa√ßos e troca virgula por ponto
                        let valorLimpo = String(v).replace('R$', '').replace(/\s/g, '').replace(',', '.');
                        let valorFinal = parseFloat(valorLimpo);
                        if(!isNaN(valorFinal)) {
                            soma += valorFinal;
                            contagem++;
                        }
                    }
                });

                document.getElementById('total-ganho').innerText = soma.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
                document.getElementById('qtd-corridas').innerText = contagem;
                document.getElementById('loading-saldo').classList.add('hidden');
                document.getElementById('painel-saldo').classList.remove('hidden');

            } catch (error) {
                console.error("Erro API:", error);
                alert("Erro de conex√£o. Verifique se a aba 'Pagamentos' existe na planilha.");
                document.getElementById('loading-saldo').classList.add('hidden');
            }
        }
    </script>
</body>
</html>
